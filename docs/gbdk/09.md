# ゲームボーイで動くプログラムを書いてみる

## 09. 十字キーでスプライトを移動してみる(参考)

完全にHelloWorldから逸脱してきていますが、これがついに最後の章です。

前の章でキー入力を学びました。そして今作っているプログラムはゲームボーイ用です。  
ゲームボーイといえばやはりゲーム。絵が動かしたいですよね。

そこで、最終章では、十字キーで絵を移動させてみます。

この章では実践問題はありません。たくさん関数が出てきますので、あくまでも参考程度、こういうこともできるんだという感じで読んでみてくださいね。

### スプライト
これは今のゲームにもある概念ですが、ざっくり言えば「キャラクターの絵」です。  
このスプライトは今でこそjpgやpngといった画像ファイルをそのまま使えますが、ゲームボーイではそんな事はできませんので、以前にも書いた「タイル」として使用します。

今回は、この8x8のスプライトを使用します。  

![](https://i.imgur.com/MYfkHH1.png)

このスプライトは色々"タイル"への変換方法があるのですが、今回は事前に作成された変換済みのものを使用します。
(コードは https://gbdev.gg8.se/wiki/articles/GBDK_Joypad_Tutorial より。一部改変。)


### コード

```c
#include <gb/gb.h>

unsigned char smile[] = {
  0x3C,0x3C,0x42,0x42,0x81,0x81,0xA5,0xA5,
  0x81,0x81,0x81,0xA5,0x42,0x5A,0x3C,0x3C
};

int main(){
	
	int x = 55;
	int y = 75;
	
	SPRITES_8x8;
	set_sprite_data(0, 0, smile);
	set_sprite_tile(0, 0);
	move_sprite(0, x, y);

	SHOW_SPRITES;

	while(1){
		if(joypad()==J_RIGHT){
			x++;
			move_sprite(0,x,y);
			delay(10);
		}
		
		if(joypad()==J_LEFT){
			x--;
			move_sprite(0,x,y);
			delay(10);
		}
		
		if(joypad()==J_UP){ 
			y--;
			move_sprite(0,x,y);
			delay(10);
		}
		
		if(joypad()==J_DOWN){ 
			y++;
			move_sprite(0,x,y);
			delay(10);
		}
	}
}
```

一旦これをコンパイルして、実行してみましょう。  

![](https://i.imgur.com/TWwiB0f.png)  

十字キーで絵が動きましたね。

### コード解説

#### include
今回はgb/gb.hでの内容しか使用していないので、これしかincludeしていません。

#### unsigned char smile[]～
ここでスプライトの情報を記載しています。  
https://qiita.com/blackpman/items/12258e6a9ee9f2d032de
に詳しいですが、"GBTD"というソフトで、描いた絵をこの形式に変換することが出来ます。

#### int x = ...
座標用の変数です。  
スプライトの移動が8ドットずつだったら嫌ですよね。なので今回は1ドットずつ指定できるよう、int型にて位置を指定できるようにします。(これはmove_sprite等、動くもののみに使用してください。)  
今回は、x:55、y:75の位置を初期位置としています。

#### SPRITES_8x8;
ここでは、「スプライトの大きさは8x8ですよ」ということを宣言しています。これがないとゲームボーイはスプライトの大きさを認知できません。

#### set_sprite_data(0, 0, smile);
smlieというスプライトを使えるようにします。

#### set_sprite_tile(0, 0);
一旦、スプライトを0, 0の位置にセットしています。

#### move_sprite(0, x, y);
この関数が今回の肝です。  
名前の通り、スプライトを動かしてくれる関数です。  
2つめと3つめの引数で、位置を指定できます。  
while文の前に書いてあるこれは、初期位置に移動するために書いてあります。

#### SHOW_SPRITES;
これで、スプライトの表示を有効化しています。  
いままでset等していましたが、それだけでは表示はされません。このSHOW_SPRITESを実行することで、ようやくスプライトが画面上に描画されます。

#### (以下if内) x++;, x--;, y++;, y--;
if文に入ってきたら、上下左右座標を一つ移動してからmove_spriteを実行するために、xやyの値を"インクリメント"、"デクリメント"しています。(++で1増やす。--で1減らす。)

#### move_sprite(0,x,y);
一つ前のインクリメント/デクリメントで変更されたxとyの値を元に、move_spriteを実行します。  
これによってようやく、スプライトが動いているように見えます。

#### delay(10);
Aボタンを押したら「PUSH A」と表示させるだけのプログラムのとき、"PUSH A"がものすごい勢いで表示されたのを覚えていますか?  
同じことがこのプログラムで起きたら、スプライトが一瞬にして移動し、吹っ飛んでしまうのです。  
そこで、delayという関数を使って、指定した時間分、処理を遅らせることが出来ます。  
先程動かしてみた時、絵がゆっくり動いたのは、このdelayがあったからなのです。

以上、スプライトを十字キーで動かしてみる方法でした。

[10. 〆/参考になるリンク等 ->](10.md)